define(["jquery","ekyna-spinner"],function(a){"use strict";function b(a,b){for(var c=0;c<b.length;c++)if(b.hasOwnProperty(c)&&!a.hasOwnProperty(b[c]))throw"Undefined property "+b[c]}function c(a){if(a.hasOwnProperty("inheritance")&&a.hasOwnProperty("namespaces"))for(var c=0;c<a.namespaces.length;c++){var d=a.namespaces[c];b(d,["name","resources"]);var f=e.find('div.acl-namespace[data-name="'+d.name+'"]');if(1!==f.size())throw"Namespace element not found";for(var g=0;g<d.resources.length;g++){var h=d.resources[g];b(h,["name","permissions"]);var i=f.find('div.acl-resource[data-name="'+h.name+'"]');if(1!==i.size())throw"Resource element not found";for(var j=0;j<h.permissions.length;j++){var k=h.permissions[j];b(k,["name","granted","value","inherited"]);var l=i.find('div.acl-permission[data-name="'+k.name+'"] button');if(1!==l.size())throw"Permission element not found";var m=l.next();a.inheritance&&!1===k.inherited?l.prop("disabled",!0).removeClass("acl-grant acl-deny").find("> i").addClass("fa-minus").removeClass("fa-check text-success fa-remove text-danger"):!1===k.value||null===k.value&&null===k.inherited?l.prop("disabled",!1).addClass("acl-grant").removeClass("acl-deny").find("> i").addClass("fa-check text-success").removeClass("fa-minus fa-remove text-danger"):l.prop("disabled",!1).addClass("acl-deny").removeClass("acl-grant").find("> i").addClass("fa-remove text-danger").removeClass("fa-minus fa-check text-success"),k.granted?l.prev().addClass("btn-success").removeClass("btn-danger"):l.prev().addClass("btn-danger").removeClass("btn-success"),1===m.size()&&(!0===k.inherited?m.find("> i").addClass("fa-check text-success").removeClass("fa-remove text-danger"):m.find("> i").addClass("fa-remove text-danger").removeClass("fa-check text-success"))}}}}function d(b,d){if(g)return!1;e.loadingSpinner();var f=a.ajax({url:b,method:"POST",data:d});return f.done(c),f.always(function(){e.loadingSpinner("off"),g=!1}),!1}var e=a(".acl-list"),f=e.data("config"),g=!1;a("div.acl-permission button").on("click",function(b){b.preventDefault(),b.stopPropagation();var c,e=a(this);if(e.hasClass("acl-grant"))c=1;else{if(!e.hasClass("acl-deny"))return!1;c=0}return d(f.permission,{namespace:e.closest("div.acl-namespace").data("name"),resource:e.closest("div.acl-resource").data("name"),permission:e.closest("div.acl-permission").data("name"),value:c}),!1}),a("button.acl-resource").on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this);return d(f.resource,{namespace:c.closest("div.acl-namespace").data("name"),resource:c.closest("div.acl-resource").data("name"),value:c.hasClass("acl-grant")?1:0}),!1}),a("button.acl-namespace").on("click",function(b){b.preventDefault(),b.stopPropagation();var c=a(this);return d(f.namespace,{namespace:c.closest("div.acl-namespace").data("name"),value:c.hasClass("acl-grant")?1:0}),!1})});