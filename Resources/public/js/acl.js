define(["jquery","ekyna-spinner"],function(s){"use strict";var m=s(".acl-list"),n=m.data("config"),r=!1;function u(e,a){for(var s=0;s<a.length;s++)if(a.hasOwnProperty(s)&&!e.hasOwnProperty(a[s]))throw"Undefined property "+a[s]}function t(e){if(e.hasOwnProperty("inheritance")&&e.hasOwnProperty("namespaces"))for(var a=0;a<e.namespaces.length;a++){var s=e.namespaces[a],n=(u(s,["name","resources"]),m.find('div.acl-namespace[data-name="'+s.name+'"]'));if(1!==n.length)throw"Namespace element not found";for(var r=0;r<s.resources.length;r++){var t=s.resources[r],d=(u(t,["name","permissions"]),n.find('div.acl-resource[data-name="'+t.name+'"]'));if(1!==d.length)throw"Resource element not found";for(var c=0;c<t.permissions.length;c++){var i=t.permissions[c],o=(u(i,["name","granted","value","inherited"]),d.find('div.acl-permission[data-name="'+i.name+'"] button'));if(1!==o.length)throw"Permission element not found";var l=o.next();e.inheritance&&!1===i.inherited?o.prop("disabled",!0).removeClass("acl-grant acl-deny").find("> i").addClass("fa-minus").removeClass("fa-check text-success fa-remove text-danger"):!1===i.value||null===i.value&&null===i.inherited?o.prop("disabled",!1).addClass("acl-grant").removeClass("acl-deny").find("> i").addClass("fa-check text-success").removeClass("fa-minus fa-remove text-danger"):o.prop("disabled",!1).addClass("acl-deny").removeClass("acl-grant").find("> i").addClass("fa-remove text-danger").removeClass("fa-minus fa-check text-success"),i.granted?o.prev().addClass("btn-success").removeClass("btn-danger"):o.prev().addClass("btn-danger").removeClass("btn-success"),1===l.length&&(!0===i.inherited?l.find("> i").addClass("fa-check text-success").removeClass("fa-remove text-danger"):l.find("> i").addClass("fa-remove text-danger").removeClass("fa-check text-success"))}}}}function c(e,a){r||(m.loadingSpinner(),(e=s.ajax({url:e,method:"POST",data:a})).done(t),e.always(function(){m.loadingSpinner("off"),r=!1}))}s("div.acl-permission button").on("click",function(e){e.preventDefault(),e.stopPropagation();var a,e=s(this);if(e.hasClass("acl-grant"))a=1;else{if(!e.hasClass("acl-deny"))return!1;a=0}return c(n.permission,{namespace:e.closest("div.acl-namespace").data("name"),resource:e.closest("div.acl-resource").data("name"),permission:e.closest("div.acl-permission").data("name"),value:a}),!1}),s("button.acl-resource").on("click",function(e){e.preventDefault(),e.stopPropagation();e=s(this);return c(n.resource,{namespace:e.closest("div.acl-namespace").data("name"),resource:e.closest("div.acl-resource").data("name"),value:e.hasClass("acl-grant")?1:0}),!1}),s("button.acl-namespace").on("click",function(e){e.preventDefault(),e.stopPropagation();e=s(this);return c(n.namespace,{namespace:e.closest("div.acl-namespace").data("name"),value:e.hasClass("acl-grant")?1:0}),!1})});