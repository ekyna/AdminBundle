define(["jquery"],function(a){function b(){this.binded=!1,this.prevent=!1,this.listeners=[],this.stack=[],this.timeout=null,this.config=b.defaults,this.start=null}return b.defaults={filter:/^[0-9A-Za-z]$/,interval:60,lengths:[8,13],endCode:"Enter",debug:!1},b.prototype.log=function(a){this.config.debug&&console.log("BarcodeScanner",a)},b.prototype.addListener=function(a){this.listeners.push(a)},b.prototype.removeListener=function(a){this.listeners=this.listeners.filter(function(b){return b!==a})},b.prototype.notify=function(){if(0!==this.stack.length){if(this.config.debug){var a=(new Date).getMilliseconds()-this.start;this.log(this.stack.length+" chars in "+a+" ms. Avg: "+Math.round(a/this.stack.length)+" ms.")}var b=this.stack.join("");this.clear(),this.listeners.forEach(function(a){a(b)})}},b.prototype.clear=function(){this.stack=[],this.start=null,this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},b.prototype.onFormFocus=function(b){a(b.currentTarget).is("[data-barcode-scanner]")||(this.log("Disabled by form focus"),this.prevent=!0,this.clear())},b.prototype.onFormBlur=function(){this.log("Enabled by form blur"),this.prevent=!1,this.clear()},b.prototype.onTimeout=function(){return this.log("Timeout "+this.stack.length),-1!==this.config.lengths.indexOf(this.stack.length)?void this.notify():void this.clear()},b.prototype.onKeydown=function(b){if(this.log("Key down "+b.key),!this.prevent)return this.config.endCode&&b.key===this.config.endCode?void this.notify():void(b.key&&this.config.filter&&this.config.filter.test(b.key)&&(this.config.debug&&null===this.start&&(this.start=(new Date).getMilliseconds()),this.stack.push(b.key),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(a.proxy(this.onTimeout,this),this.config.interval)))},b.prototype.init=function(c){this.config=a.extend({},b.defaults,c||{}),this.log(this.config),this.binded||(a(document).on("focus","input, select, textarea, button",a.proxy(this.onFormFocus,this)).on("blur","input, select, textarea, button",a.proxy(this.onFormBlur,this)).on("keydown",a.proxy(this.onKeydown,this)),this.binded=!0)},new b});