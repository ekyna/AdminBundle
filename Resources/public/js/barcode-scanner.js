define(["jquery"],function(i){function e(){this.binded=!1,this.prevent=!1,this.listeners=[],this.stack=[],this.timeout=null,this.config=e.defaults,this.start=null}return e.defaults={filter:/^[0-9A-Za-z]$/,interval:60,lengths:[8,13],endCode:"Enter",debug:!1},e.prototype.log=function(t){this.config.debug&&console.log("BarcodeScanner",t)},e.prototype.addListener=function(t){this.listeners.push(t)},e.prototype.removeListener=function(i){this.listeners=this.listeners.filter(function(t){return t!==i})},e.prototype.notify=function(){if(0!==this.stack.length){var t;this.config.debug&&(t=(new Date).getMilliseconds()-this.start,this.log(this.stack.length+" chars in "+t+" ms. Avg: "+Math.round(t/this.stack.length)+" ms."));const i=this.stack.join("");this.clear(),this.listeners.forEach(function(t){t(i)})}},e.prototype.clear=function(){this.stack=[],this.start=null,this.timeout&&(clearTimeout(this.timeout),this.timeout=null)},e.prototype.onFormFocus=function(t){i(t.currentTarget).is("[data-barcode-scanner]")||(this.log("Disabled by form focus"),this.prevent=!0,this.clear())},e.prototype.onFormBlur=function(){this.log("Enabled by form blur"),this.prevent=!1,this.clear()},e.prototype.onTimeout=function(){this.log("Timeout "+this.stack.length),-1===this.config.lengths.indexOf(this.stack.length)?this.clear():this.notify()},e.prototype.onKeydown=function(t){this.log("Key down "+t.key),this.prevent||(this.config.endCode&&t.key===this.config.endCode?this.notify():t.key&&this.config.filter&&this.config.filter.test(t.key)&&(this.config.debug&&null===this.start&&(this.start=(new Date).getMilliseconds()),this.stack.push(t.key),this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>this.onTimeout(),this.config.interval)))},e.prototype.init=function(t){this.config=i.extend({},e.defaults,t||{}),this.log(this.config),this.binded||(i(document).on("focus","input, select, textarea, button",t=>this.onFormFocus(t)).on("blur","input, select, textarea, button",()=>this.onFormBlur()).on("keydown",t=>this.onKeydown(t)),this.binded=!0)},new e});