require(["require","jquery","routing","ekyna-api","bootstrap","jquery/form","ekyna-clipboard-copy"],function(e,c,l,t){t.init("admin_api_login"),c(document).ajaxError(function(e,t){403===t.status&&window.location.reload()});var n,a,t=c("ul.nav-tabs[data-tab-key]"),t=(1===t.length&&function(e){try{var t=window[e],n="__storage_test__";return t.setItem(n,n),t.removeItem(n),1}catch(e){return e instanceof DOMException&&(22===e.code||1014===e.code||"QuotaExceededError"===e.name||"NS_ERROR_DOM_QUOTA_REACHED"===e.name)&&0!==t.length}}("localStorage")&&(n=t.data("tab-key")+".tab_id",t.on("click","a",function(e){e.preventDefault(),c(this).tab("show");e=c(this).attr("id");e&&localStorage.setItem(n,e)}),(a=localStorage.getItem(n))&&t.find("a#"+a).trigger("click")),c("#sidebar-menu").on("click",".dropdown-toggle",function(e){e.preventDefault();e=c(this).parent();e.toggleClass("active"),e.hasClass("active")?e.find(".submenu").slideDown("fast"):e.find(".submenu").slideUp("fast")}),c("#sidebar-nav")),i=(c("body").click(function(){c(this).hasClass("menu")&&c(this).removeClass("menu")}),t.click(function(e){e.stopPropagation()}),c("#menu-toggler").click(function(e){e.stopPropagation(),c("body").toggleClass("menu")}),c(window).resize(function(){769<c(this).width()&&c("body.menu").removeClass("menu")}),t.height()>c(".content").height()&&c("html").addClass("small"),c(document).on("select2:open",()=>{document.querySelector(".select2-search__field").focus()}),c(document).on("click",".nav-tabs a",function(e){e.preventDefault(),c(this).tab("show")}),c("form")),o=(0<i.length&&e(["ekyna-form"],function(n){i.each(function(e,t){n.create(t).init()})}),c(".ekyna-table"));0<o.length&&e(["ekyna-table"],function(n){o.each(function(e,t){n.create(t)})});try{e(["ekyna-media/thumb"],function(e){e.init()})}catch(e){console.log("Media thumb is not available.")}c(document).on("click","a[data-toggle-details]",function(e){e.preventDefault();e=c(this),e=c("#"+e.data("toggle-details"));return 1===e.length&&(e.is(":visible")?e.hide():e.show()),!1}),e(["ekyna-admin/summary"],function(e){e.init()}),e(["ekyna-admin/side-detail"],function(e){e.init()});var r=c("#barcode-scanner-button"),s=(e(["ekyna-admin/barcode-scanner"],function(e){e.init({}),e.addListener(function(e){r.find("> i").removeClass("fa-barcode").addClass("fa-spinner fa-pulse fa-3x fa-fw");e=c.ajax({url:l.generate("admin_toolbar_barcode",{barcode:e}),method:"GET"});e.done(function(e,t,n){if("text/html"!==n.getResponseHeader("Content-Type")){if("application/json"!==n.getResponseHeader("Content-Type"))throw"Unexpected barcode response type";if(e.hasOwnProperty("results")&&0!==e.results.length)if(1!==e.results.length)e.results.forEach(function(e){});else if("redirect"===e.results[0].type)window.location.href=e.results[0].url;else{if("modal"!==e.results[0].type)throw"Unexpected result type";console.log("Not yet implemented")}}}),e.always(function(){r.find("> i").removeClass("fa-spinner fa-pulse fa-3x fa-fw").addClass("fa-barcode")})})}),function(){var e,t,n=this,a=!1,i=c("#wide-search > form"),o=i.find("input[type=text]"),r=i.find("input[type=checkbox]"),s=i.find(".input-group-addon > i"),d=c("#wide-search > div.list-group");this.start=function(){a=!0,s.removeClass("fa-search").addClass("fa-spinner fa-spin"),t&&clearTimeout(t),e&&e.abort(),t=setTimeout(n.search,300)},this.stop=function(){a=!1,s.removeClass("fa-spinner fa-spin").addClass("fa-search")},this.search=function(){d.empty(),""!==o.val()?((e=c.ajax({url:l.generate("admin_toolbar_search"),method:"POST",data:i.formSerialize(),dataType:"json"})).done(function(e){n.stop(),e.hasOwnProperty("results")&&0!==e.results.length&&(e.results.forEach(function(e){var t=c('<a class="list-group-item"></a>');e.icon&&c("<i></i>").addClass(e.icon).appendTo(t),t.append(document.createTextNode(e.title)),t.attr("href",e.url),t.appendTo(d)}),d.show())}),e.always(function(){})):n.stop()},this.init=function(){i.find(".dropdown-menu input, .dropdown-menu label").on("click",function(e){e.stopPropagation()}),r.on("change",n.start),o.on("keyup",n.start),o.on("focus",function(){d.is(":empty")?""!==o.val()&&n.start():d.show()}),c(document).on("click",function(e){a||1!==c(e.target).closest("#wide-search").length&&d.hide()})},this.init()}(),c(".navbar li.user-pins > div"));function d(e){var t,n,a;e.hasOwnProperty("added")?(t=c('<span data-id="'+e.added.id+'"></span>'),n=c('<a href="'+e.added.path+'" title="'+e.added.label+'">'+e.added.label+"</a>"),a='<a href="'+l.generate("admin_pin_remove",{id:e.added.id})+'"><i class="fa fa-remove"></i></a>',t.append(n).append(a).prependTo(s),1===(t=c('a.user-pin[data-resource="'+e.added.resource+'"][data-identifier="'+e.added.identifier+'"]')).length&&t.addClass("unpin").attr("href",l.generate("admin_pin_resource_unpin",{name:e.added.resource,identifier:e.added.identifier}))):e.hasOwnProperty("removed")&&(s.find("span[data-id="+e.removed.id+"]").remove(),1===(t=c('a.user-pin[data-resource="'+e.removed.resource+'"][data-identifier="'+e.removed.identifier+'"]')).length&&t.removeClass("unpin").attr("href",l.generate("admin_pin_resource_pin",{name:e.removed.resource,identifier:e.removed.identifier})))}c(document).on("click","a.user-pin",function(e){e.preventDefault();e=c(this).attr("href");return c.ajax({url:e,method:"GET",dataType:"json"}).done(d),!1}),c("li.user-pins").on("click","a:last-child",function(e){e.preventDefault();e=c(this).attr("href");return c.ajax({url:e,method:"GET",dataType:"json"}).done(d),!1})});