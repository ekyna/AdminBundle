require(["require","jquery","routing","bootstrap","jquery/form","ekyna-clipboard-copy"],function(a,b,c){function d(a){try{var b=window[a],c="__storage_test__";return b.setItem(c,c),b.removeItem(c),!0}catch(d){return d instanceof DOMException&&(22===d.code||1014===d.code||"QuotaExceededError"===d.name||"NS_ERROR_DOM_QUOTA_REACHED"===d.name)&&0!==b.length}}function e(a){var d;if(a.hasOwnProperty("added")){var e=b('<span data-id="'+a.added.id+'"></span>'),f=b('<a href="'+a.added.path+'" title="'+a.added.label+'">'+a.added.label+"</a>"),g=c.generate("ekyna_admin_pin_remove",{id:a.added.id}),h='<a href="'+g+'"><i class="fa fa-remove"></i></a>';e.append(f).append(h).prependTo(o),d=b('a.user-pin[data-resource="'+a.added.resource+'"][data-identifier="'+a.added.identifier+'"]'),1===d.size()&&d.addClass("unpin").attr("href",c.generate("ekyna_admin_pin_resource_unpin",{name:a.added.resource,identifier:a.added.identifier}))}else a.hasOwnProperty("removed")&&(o.find("span[data-id="+a.removed.id+"]").remove(),d=b('a.user-pin[data-resource="'+a.removed.resource+'"][data-identifier="'+a.removed.identifier+'"]'),1===d.size()&&d.removeClass("unpin").attr("href",c.generate("ekyna_admin_pin_resource_pin",{name:a.removed.resource,identifier:a.removed.identifier})))}function f(a){p.empty(),a&&(p.append(q),b.ajax({url:c.generate("ekyna_setting_api_helper_fetch"),data:{reference:a},type:"GET",dataType:"xml"}).done(function(a){q.remove();var c=b(a).find("content");if(1===c.length){var d=b("<div />");b(c.text()).appendTo(d),d.appendTo(p)}}).always(function(){q.remove()}))}b(document).ajaxError(function(a,b){403===b.status&&window.location.reload()});var g=b("ul.nav-tabs[data-tab-key]");if(1===g.size()&&d("localStorage")){var h=g.data("tab-key")+".tab_id";g.on("click","a",function(a){a.preventDefault(),b(this).tab("show");var c=b(this).attr("id");c&&localStorage.setItem(h,c)});var i=localStorage.getItem(h);i&&g.find("a#"+i).trigger("click")}b("#sidebar-menu").on("click",".dropdown-toggle",function(a){a.preventDefault();var c=b(this).parent();c.toggleClass("active"),c.hasClass("active")?c.find(".submenu").slideDown("fast"):c.find(".submenu").slideUp("fast")});var j=b("#sidebar-nav");b("body").click(function(){b(this).hasClass("menu")&&b(this).removeClass("menu")}),j.click(function(a){a.stopPropagation()}),b("#menu-toggler").click(function(a){a.stopPropagation(),b("body").toggleClass("menu")}),b(window).resize(function(){b(this).width()>769&&b("body.menu").removeClass("menu")}),j.height()>b(".content").height()&&b("html").addClass("small"),b(document).on("click",".nav-tabs a",function(a){a.preventDefault(),b(this).tab("show")});var k=b("form");k.size()>0&&a(["ekyna-form"],function(a){k.each(function(b,c){var d=a.create(c);d.init()})});var l=b(".ekyna-table");l.size()>0&&a(["ekyna-table"],function(a){l.each(function(b,c){a.create(c)})});try{a(["ekyna-media/thumb"],function(a){a.init()})}catch(m){console.log("Media thumb is not available.")}b(document).on("click","a[data-toggle-details]",function(a){a.preventDefault();var c=b(this),d=b("#"+c.data("toggle-details"));return 1===d.size()&&(d.is(":visible")?d.hide():d.show()),!1}),a(["ekyna-admin/summary"],function(a){a.init()}),a(["ekyna-admin/side-detail"],function(a){a.init()});var n=b("#barcode-scanner-button");a(["ekyna-admin/barcode-scanner"],function(a){a.init({}),a.addListener(function(a){n.find("> i").removeClass("fa-barcode").addClass("fa-spinner fa-pulse fa-3x fa-fw");var d=b.ajax({url:c.generate("ekyna_admin_toolbar_barcode",{barcode:a}),method:"GET"});d.done(function(a,b,c){if("text/html"!==c.getResponseHeader("Content-Type")){if("application/json"!==c.getResponseHeader("Content-Type"))throw"Unexpected barcode response type";if(a.hasOwnProperty("results")&&0!==a.results.length)if(1!==a.results.length)a.results.forEach(function(a){});else if("redirect"===a.results[0].type)window.location.href=a.results[0].url;else{if("modal"!==a.results[0].type)throw"Unexpected result type";console.log("Not yet implemented")}}}),d.always(function(){n.find("> i").removeClass("fa-spinner fa-pulse fa-3x fa-fw").addClass("fa-barcode")})})}),function(){var a,d,e=this,f=!1,g=b("#wide-search > form"),h=g.find("input[type=text]"),i=g.find("input[type=checkbox]"),j=g.find(".input-group-addon > i"),k=b("#wide-search > div.list-group");this.start=function(){f=!0,j.removeClass("fa-search").addClass("fa-spinner fa-spin"),d&&clearTimeout(d),a&&a.abort(),d=setTimeout(e.search,300)},this.stop=function(){f=!1,j.removeClass("fa-spinner fa-spin").addClass("fa-search")},this.search=function(){return k.empty(),""===h.val()?void e.stop():(a=b.ajax({url:c.generate("ekyna_admin_toolbar_search"),method:"POST",data:g.formSerialize(),dataType:"json"}),a.done(function(a){e.stop(),a.hasOwnProperty("results")&&0!==a.results.length&&(a.results.forEach(function(a){var c=b('<a class="list-group-item"></a>');a.icon&&b("<i></i>").addClass(a.icon).appendTo(c),c.append(document.createTextNode(a.title)),c.attr("href",a.url),c.appendTo(k)}),k.show())}),void a.always(function(){}))},this.init=function(){g.find(".dropdown-menu input, .dropdown-menu label").on("click",function(a){a.stopPropagation()}),i.on("change",e.start),h.on("keyup",e.start),h.on("focus",function(){return k.is(":empty")?void(""!==h.val()&&e.start()):void k.show()}),b(document).on("click",function(a){f||1!==b(a.target).closest("#wide-search").length&&k.hide()})},this.init()}();var o=b(".navbar li.user-pins > div");b(document).on("click","a.user-pin",function(a){a.preventDefault();var c=b(this),d=c.attr("href");return b.ajax({url:d,method:"GET",dataType:"json"}).done(e),!1}),b("li.user-pins").on("click","a:last-child",function(a){a.preventDefault();var c=b(this),d=c.attr("href");return b.ajax({url:d,method:"GET",dataType:"json"}).done(e),!1});var p=b("#helper-content:visible"),q=b('<p id="helper-content-loading"><i class="fa fa-spinner fa-spin fa-2x"></i></p>');if(1===p.length){var r=p.data("helper")||null;f(r),k.on("focus","*[data-helper]",function(){f(b(this).data("helper"))}).on("blur","*[data-helper]",function(){f(r)})}});